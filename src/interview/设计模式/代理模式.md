# ä»£ç†æ¨¡å¼

ç”±äºç§ç§åŸå› ï¼Œä¸€ä¸ªå¯¹è±¡**ä¸èƒ½ç›´æ¥è®¿é—®**å¦ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ä¸€ä¸ª**ç¬¬ä¸‰è€…**ï¼ˆä»£ç†ï¼‰ä»è€Œé—´æ¥è¾¾åˆ°è®¿é—®ç›®çš„ã€‚

ğŸŒ°

- ç§‘å­¦ä¸Šç½‘
- äº‹ä»¶å§”æ‰˜
- ...

```typescript
// ä¸ä½¿ç”¨ä»£ç†æ¨¡å¼ä¸‹éœ€è¦å¾ªç¯ç›‘å¬å‡½æ•°ï¼Œæ€§èƒ½å¼€é”€ä¼šå¤§
const aNodes = document
  .getElementsByClassName("father")[0]
  .getElementsByTagName("a");
const length = aNodes.length;

for (let index = 0; index < length; index++) {
  aNodes[index].addEventListener("click", (e) => {
    e.preventDefault();
    console.log(`${aNodes[index].innerText}`);
  });
}
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="father">
      <a href="#">##1##</a>
      <a href="#">##2##</a>
      <a href="#">##3##</a>
      <a href="#">##4##</a>
      <a href="#">##5##</a>
      <a href="#">##6##</a>
    </div>
    <script src="./dist/test.js"></script>
  </body>
</html>
```

### äº‹ä»¶ä»£ç†

ä½¿ç”¨äº‹ä»¶ä»£ç†æ¨¡å¼ï¼Œå°†äº‹ä»¶ä»£ç†åˆ°çˆ¶å…ƒç´ ä¸Šï¼Œé€šè¿‡çˆ¶å…ƒç´ å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†å’Œåˆ†å‘ï¼Œé—´æ¥ä½œç”¨äºå­å…ƒç´ ã€‚

```typescript
const fatherNodes = document.getElementsByClassName("father")[0];

fatherNodes.addEventListener("click", (e) => {
  if ((e?.target as HTMLElement).tagName === "A") {
    e.preventDefault();
    console.log(`${(e?.target as HTMLElement).innerText}`);
  }
});
```

### è™šæ‹Ÿä»£ç†

#### å›¾ç‰‡é¢„åŠ è½½

å…ˆè®© img æ ‡ç­¾å±•ç¤ºä¸€ä¸ªå ä½å›¾ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª image å®ä¾‹ï¼Œè®©è¿™ä¸ª image çš„å®ä¾‹çš„ src æŒ‡å‘çœŸå®çš„å›¾ç‰‡åœ°å€ï¼Œè§‚å¯Ÿè¯¥ image å®ä¾‹çš„åŠ è½½æƒ…å†µï¼Œå½“å…¶å¯¹åº”çš„çœŸå®å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œå³æœ‰äº†çœŸå®å›¾ç‰‡çš„ç¼“å­˜ï¼Œå†å°† DOM ä¸Šçš„ img å…ƒç´ çš„ src æŒ‡å‘çœŸå®çš„ç›®æ ‡å›¾ç‰‡åœ°å€ã€‚è¿™ä¸ªæ—¶å€™å»å–çœŸå®å›¾ç‰‡çš„ç¼“å­˜ï¼Œä¿è¯äº†ç”¨æˆ·çš„ä½“éªŒã€‚

ç¬¬ä¸€ç‰ˆæœ¬

```typescript
class PreLoadImg {
  // å ä½å›¾ url åœ°å€
  static LOADING_IMG = "https://cdn2.thecatapi.com/images/8kq.gif";
  imgNode: HTMLImageElement;

  constructor(imgNode: HTMLImageElement) {
    this.imgNode = imgNode;
  }

  // è®¾ç½®çœŸå®çš„å›¾ç‰‡åœ°å€
  setSrc(targetUrl: string) {
    // img èŠ‚ç‚¹åˆå§‹åŒ–æ—¶å€™å±•ç¤ºä¸€ä¸ªå ä½å›¾
    this.imgNode.src = PreLoadImg.LOADING_IMG;
    // åˆ›å»ºä¸€ä¸ªå¸®åŠ©åŠ è½½çš„ Image å®ä¾‹
    const image = new Image();
    // ç›‘å¬ç›®æ ‡å›¾ç‰‡çš„åŠ è½½æƒ…å†µï¼Œå®Œæˆæ—¶å†å°† img èŠ‚ç‚¹çš„ src å±æ€§è®¾ç½®ä¸ºç›®æ ‡å›¾ç‰‡çš„ url
    image.onload = () => {
      this.imgNode.src = targetUrl;
    };
    // è®¾ç½® src å±æ€§ï¼ŒImage å®ä¾‹å¼€å§‹åŠ è½½å›¾ç‰‡
    image.src = targetUrl;
  }
}

const imgNode = document.getElementsByTagName("img")[0];
const preLoadImg = new PreLoadImg(imgNode);

preLoadImg.setSrc("https://cdn2.thecatapi.com/images/ced.jpg");
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    .test-img {
      width: 200px;
      height: 200px;
    }
  </style>
  <body>
    <div class="father">
      <img class="test-img" src="" alt="" />
    </div>
    <script src="./dist/test.js"></script>
  </body>
</html>
```

ä¸Šè¿°ä»£ç è¿åäº†è®¾è®¡åŸåˆ™çš„**å•ä¸€èŒè´£åŸåˆ™**ã€‚ PreLoadImg ä¸ä»…è´Ÿè´£å›¾ç‰‡çš„åŠ è½½ï¼Œè¿˜è¦è´Ÿè´£ DOM å±‚é¢çš„æ“ä½œï¼Œè¿™å°±å‡ºç°äº†**ä¸¤ä¸ªå¯èƒ½å¯¼è‡´è¿™ä¸ªç±»å‘ç”Ÿå˜åŒ–çš„åŸå› **ã€‚

æ‰€ä»¥è¦å°†ä¸¤ä¸ªé€»è¾‘åˆ†ç¦»ï¼ŒPreLoadImage ä¸“å¿ƒå»åš DOM å±‚é¢çš„äº‹æƒ…ï¼Œå†è®¾ç½®ä¸€ä¸ªå¯¹è±¡æ¥åšåŠ è½½ã€‚ç„¶åä½¿ç”¨ä»£ç†å™¨å¸®ä¸¤ä¸ªå¯¹è±¡å…³è”èµ·æ¥ã€‚

ç¬¬äºŒç‰ˆæœ¬

```typescript
class PreLoadImg {
  // çœŸå®çš„ dom èŠ‚ç‚¹
  imgNode: HTMLImageElement;

  constructor(imgNode: HTMLImageElement) {
    this.imgNode = imgNode;
  }

  // è®¾ç½®çœŸå®çš„å›¾ç‰‡åœ°å€
  setSrc(targetUrl: string) {
    this.imgNode.src = targetUrl;
  }
}

class ProxyImg {
  // å ä½å›¾ url åœ°å€
  static LOADING_IMG = "https://cdn2.thecatapi.com/images/8kq.gif";
  // ç›®æ ‡Imageï¼Œå³PreLoadImageå®ä¾‹
  targetImg: PreLoadImg;

  constructor(targetImg: PreLoadImg) {
    this.targetImg = targetImg;
  }

  setSrc(targetUrl: string) {
    // çœŸå®imgèŠ‚ç‚¹åˆå§‹åŒ–æ—¶å±•ç¤ºçš„æ˜¯ä¸€ä¸ªå ä½å›¾
    this.targetImg.setSrc(ProxyImg.LOADING_IMG);
    // åˆ›å»ºä¸€ä¸ªå¸®åŠ©åŠ è½½çš„ Image å®ä¾‹
    const vImage = new Image();
    // ç›‘å¬ç›®æ ‡å›¾ç‰‡çš„åŠ è½½æƒ…å†µï¼Œå®Œæˆæ—¶å†å°† img èŠ‚ç‚¹çš„ src å±æ€§è®¾ç½®ä¸ºç›®æ ‡å›¾ç‰‡çš„ url
    vImage.onload = () => {
      this.targetImg.setSrc(targetUrl);
    };
    // è®¾ç½® src å±æ€§ï¼ŒImage å®ä¾‹å¼€å§‹åŠ è½½å›¾ç‰‡
    vImage.src = targetUrl;
  }
}

const imgNode = document.getElementsByTagName("img")[0];
const preLoadImg = new PreLoadImg(imgNode);
const proxyImg = new ProxyImg(preLoadImg);

proxyImg.setSrc("https://cdn2.thecatapi.com/images/ced.jpg");
```

ProxyImg åšäº†é¢„åŠ è½½çš„å·¥ä½œï¼Œé€šè¿‡ ProxyImg è¿™ä¸ªä»£ç†ï¼Œå®ç°å¯¹çœŸå® img èŠ‚ç‚¹çš„é—´æ¥è®¿é—®ï¼Œå®ç°ç›¸åº”çš„æ•ˆæœã€‚

vImage ä»£æ›¿çœŸå® DOM å‘èµ·å›¾ç‰‡çš„è¯·æ±‚ï¼Œå’Œå®Œæˆå›¾ç‰‡çš„åŠ è½½ï¼Œä½†æ˜¯å´ä»æœªå‡ºç°åœ¨æ¸²æŸ“å±‚ï¼Œå› æ­¤è¿™ç§æ¨¡å¼è¢«ç§°ä¸º**è™šæ‹Ÿä»£ç†**

### ç¼“å­˜ä»£ç†

åœ¨ä¸€äº›è®¡ç®—é‡è¾ƒå¤§çš„åœºæ™¯é‡Œ\*\*ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦â€œç”¨ç©ºé—´æ¢æ—¶é—´â€â€”â€”å½“æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸä¸ªå·²ç»è®¡ç®—è¿‡çš„å€¼çš„æ—¶å€™ï¼Œä¸æƒ³å†è€—æ—¶è¿›è¡ŒäºŒæ¬¡è®¡ç®—ï¼Œ
å¯¹è¿›è¡Œè¿‡è®¡ç®—çš„æ•°æ®ï¼Œç›´æ¥ä»ç¼“å­˜ç»“æœä¸­è·å–ã€‚

```typescript
const addAll = (...rest: number[]) => {
  console.log("first calculation");
  let result: number = 0;
  rest.forEach((item) => {
    result += item;
  });

  return result;
};

const proxyAddAll = (() => {
  // æ±‚å’Œç»“æœç¼“å­˜æ± 
  const resultCache = {};

  return (...reset: number[]) => {
    const key = [].join.call(reset, ",");

    if (key in resultCache) {
      return resultCache[key];
    }
    return (resultCache[key] = addAll(...reset));
  };
})();

console.log(proxyAddAll(1, 2, 3, 4, 5, 6)); // first calculation 21
console.log(proxyAddAll(1, 2, 3, 4, 5, 6)); // 21
```

### ä¿æŠ¤ä»£ç†

ä¸»è¦æ˜¯ä½¿ç”¨ proxy æ¥å®ç°

```typescript
let validator = {
  set: function (obj, prop, value) {
    if (prop === "age") {
      if (!Number.isInteger(value)) {
        throw new TypeError("The age is not an integer");
      }
      if (value > 200) {
        throw new RangeError("The age seems invalid");
      }
    }

    // å¯¹äºæ»¡è¶³æ¡ä»¶çš„ age å±æ€§ä»¥åŠå…¶ä»–å±æ€§ï¼Œç›´æ¥ä¿å­˜
    obj[prop] = value;
    return true;
  },
};

let person = new Proxy({}, validator);

person.age = 100;

person.age; // 100
person.age = "young"; // æŠ¥é”™
person.age = 300; // æŠ¥é”™
```
